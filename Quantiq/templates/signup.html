<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.x.x/dist/tailwind.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/keen-slider@6.8.6/keen-slider.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js" defer></script>
    <style>
        /* Custom styles for inputs and selects */
        input[type="text"],
        input[type="email"],
        input[type="password"],
        select {
            font-size: 1rem;
            padding: 0.5rem;
            border-width: 2px;
        }
        
        select:disabled,
        select option[disabled] {
            color: rgba(107, 114, 128, 0.5);
        }
    </style>
    <title>Sign Up</title>
</head>
<body>
    <section class="bg-white">
        <div class="lg:grid lg:min-h-screen lg:grid-cols-12">
            <aside class="relative block h-16 lg:order-last lg:col-span-5 lg:h-full xl:col-span-6">
                <img alt="Graphs" src="assets/screen_graphs.jpg" class="absolute inset-0 h-full w-full object-cover" />
            </aside>
            <main class="flex items-center justify-center px-8 py-8 sm:px-12 lg:col-span-7 lg:px-16 lg:py-12 xl:col-span-6">
                <div class="max-w-xl lg:max-w-3xl">
                    <h1 class="mt-6 text-2xl font-bold text-gray-900 sm:text-3xl md:text-4xl">
                        Welcome to QuantIQ ⚛️
                    </h1>
                    <p class="mt-4 leading-relaxed text-gray-500">
                        Join QuantIQ today and unlock powerful insights for smarter financial decisions—tailored for professionals in data, finance, and analytics.
                    </p>
                    
                    <!-- Updated Form (Now submits to /signup/) -->
                    <form action="/signup/" method="POST" class="mt-8 grid grid-cols-6 gap-6" id="signup-form">
                        {% csrf_token %}
                        <div class="col-span-6 sm:col-span-3">
                            <label for="firstname" class="block text-sm font-medium text-gray-700">First Name</label>
                            <input type="text" id="firstname" name="first_name" class="mt-1 w-full rounded-md border-gray-200 bg-white text-sm text-gray-700 shadow-sm" />
                        </div>
                        <div class="col-span-6 sm:col-span-3">
                            <label for="lastname" class="block text-sm font-medium text-gray-700">Last Name</label>
                            <input type="text" id="lastname" name="last_name" class="mt-1 w-full rounded-md border-gray-200 bg-white text-sm text-gray-700 shadow-sm" />
                        </div>
                        <div class="col-span-6">
                            <label for="companyname" class="block text-sm font-medium text-gray-700">Company Name</label>
                            <input type="text" id="companyname" name="company_name" class="mt-1 w-full rounded-md border-gray-200 bg-white text-sm text-gray-700 shadow-sm" />
                        </div>
                        
                        <div class="col-span-6">
                            <label for="company_type" class="block text-sm font-medium text-gray-700">Company Type</label>
                            <input type="text" id="company_type" name="company_type" class="mt-1 w-full rounded-md border-gray-200 bg-white text-sm text-gray-700 shadow-sm" />
                        </div>
                        <div class="col-span-6">
                            <label for="industry" class="block text-sm font-medium text-gray-700">Industry</label>
                            <input type="text" id="industry" name="industry" class="mt-1 w-full rounded-md border-gray-200 bg-white text-sm text-gray-700 shadow-sm" />
                        </div>
                        <div class="col-span-6">
                            <label for="email" class="block text-sm font-medium text-gray-700">Corporate Email</label>
                            <input type="email" id="email" name="email" class="mt-1 w-full rounded-md border-gray-200 bg-white text-sm text-gray-700 shadow-sm" />
                        </div>
                        <div class="col-span-6 sm:col-span-3">
                            <label for="password" class="block text-sm font-medium text-gray-700">Password</label>
                            <input type="password" id="password" name="password" class="mt-1 w-full rounded-md border-gray-200 bg-white text-sm text-gray-700 shadow-sm" />
                        </div>
                        <div class="col-span-6 sm:col-span-3">
                            <label for="passwordconfirmation" class="block text-sm font-medium text-gray-700">Password Confirmation</label>
                            <input type="password" id="passwordconfirmation" name="password_confirmation" class="mt-1 w-full rounded-md border-gray-200 bg-white text-sm text-gray-700 shadow-sm" />
                        </div>
                        <div class="col-span-6">
                            <label for="MarketingAccept" class="flex gap-4">
                                <input type="checkbox" id="MarketingAccept" name="marketing_accept" class="size-5 rounded-md border-gray-200 bg-white shadow-sm" />
                                <span class="text-sm text-gray-700">I want to receive emails about events, product updates and company announcements.</span>
                            </label>
                        </div>
                        <div class="col-span-6">
                            <p class="text-sm text-gray-500">
                                By creating an account, you agree to our
                                <a href="#" class="text-gray-700 underline">terms and conditions</a> and
                                <a href="#" class="text-gray-700 underline">privacy policy</a>.
                            </p>
                        </div>
                        <div class="col-span-6 sm:flex sm:items-center sm:gap-4">
                            <button class="inline-block shrink-0 rounded-md border border-blue-600 bg-blue-600 px-12 py-3 text-sm font-medium text-white transition hover:bg-transparent hover:text-blue-600 focus:outline-none focus:ring active:text-blue-500">
                                Create an account
                            </button>
                            <p class="mt-4 text-sm text-gray-500 sm:mt-0">
                                Already have an account? <a href="/signin" class="text-gray-700 underline">Log in</a>.
                            </p>
                        </div>
                    </form>
                </div>
            </main>
        </div>
    </section>

    <script>
        function validateForm() {
            const password = document.getElementById("password").value;
            const passwordConfirm = document.getElementById("passwordconfirmation").value;
        
            if (password.length < 8) {
                alert("Password must be at least 8 characters long.");
                return false;
            }
            if (!/[A-Z]/.test(password) || !/[0-9]/.test(password)) {
                alert("Password must contain at least one uppercase letter and one number.");
                return false;
            }
            if (password !== passwordConfirm) {
                alert("Passwords do not match.");
                return false;
            }
            return true;
        }
        
        document.getElementById('signup-form').addEventListener('submit', async (e) => {
            e.preventDefault();
            if (!validateForm()) return;
        
            const formData = new FormData(e.target);
            
            try {
                const response = await fetch('/signup/', {
                    method: 'POST',
                    headers: { 'X-CSRFToken': formData.get('csrfmiddlewaretoken') }, // Include CSRF token if needed
                    body: formData
                });
        
                if (response.ok) {
                    alert('Signup successful! Redirecting to dashboard...');
                    window.location.href = '/dashboard/';
                } else {
                    const errorData = await response.json();
                    alert('Signup failed: ' + (errorData.message || "An error occurred."));
                }
            } catch (error) {
                console.error('Error:', error);
                alert('An unexpected error occurred.');
            }
        });

        function getCSRFToken() {
            let cookieValue = null;
            const cookies = document.cookie.split(';');
            for (let i = 0; i < cookies.length; i++) {
                const cookie = cookies[i].trim();
                if (cookie.startsWith("csrftoken=")) {
                    cookieValue = cookie.substring("csrftoken=".length, cookie.length);
                    break;
                }
            }
            return cookieValue;
        }
        
        document.getElementById('signup-form').addEventListener('submit', async (e) => {
            e.preventDefault();
            if (!validateForm()) return;
        
            const data = {
                first_name: document.getElementById('firstname').value,
                last_name: document.getElementById('lastname').value,
                email: document.getElementById('email').value,
                password: document.getElementById('password').value,
            };
        
            try {
                const response = await fetch('/signup/', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'X-CSRFToken': getCSRFToken()  // Include CSRF token in request headers
                    },
                    body: JSON.stringify(data)
                });
        
                if (response.ok) {
                    alert('Signup successful! Redirecting to dashboard...');
                    window.location.href = '/dashboard/';
                } else {
                    const errorText = await response.text();
                    alert('Signup failed: ' + errorText);
                }
            } catch (error) {
                console.error('Error:', error);
                alert('An unexpected error occurred.');
            }
        });
        
        
    </script>
</body>
</html>
